---
title: "Ts_week3_assignment_Xingqi"
author: "Xingqi"
date: "January 27, 2015"
output: pdf_document
---

Use the dataset at http://www.stat.wisc.edu/~reinsel/bjr-data/unem-gdp

##1.Use datasets from 1955 to 1968 to build an ARMA or ARIMA models for UN and GDP.

```{r}
UN.GDP<- read.csv(file="UN_GDP.csv",header=TRUE,sep=",")
str(UN.GDP)
```

```{r}

UN.all<-ts(UN.GDP[,1],start=c(1955,1),frequency =4)
GDP.all<-ts(UN.GDP[,2],start=c(1955,1),frequency =4)
UN<-UN.all[1:56]
GDP<-GDP.all[1:56]
UN.GDP.ts<-cbind(UN,GDP)
```


```{r}
plot.ts(ts(UN.GDP[,1:2],start=c(1955,1),frequency =4),type='o',xlab="year",
        main="UN_GDP")
```

observe the scatterplot of UN and lag of UN.

```{r message=FALSE, warning=FALSE}
library(TSA)
plot(y=UN,x=zlag(UN),ylab=expression(UNY[t]),
     xlab=expression(Y[t-1]),type='p')
```

observe the scatterplot of GDP and lag of GDP.

```{r}
plot(y=GDP,x=zlag(GDP),ylab=expression(GDPY[t]),
     xlab=expression(Y[t-1]),type='p')

```

Build ARMA and ARIMA models for UN and GDP

```{r message=FALSE, warning=FALSE}
library(forecast)
UN.arma<-arma(UN)
UN.arima<-auto.arima(UN);UN.arima
GDP.arma<-arma(GDP)
GDP.arima<-auto.arima(GDP);GDP.arima
```

Using the output from auto.arima model, build a second model for UN or GDP

```{r}
UN.arima2 <- arima(UN, order=c(1,1,0))
GDP.arima2<- arima(GDP,order=c(0,1,0))
```


##2.Justify why you chose (ARMA or ARIMA) one over the other.  Note there will be 2 models, one for UN and another for GDP.

For UN, the summary of models is as follows

```{r}
summary(UN.arma)
summary(UN.arima)
summary(UN.arima2)
paste("UN.arma=",summary(UN.arma)$aic,
      "UN.arima=",UN.arima$aic, 
      "UN.arima2=", UN.arima2$aic)
```


The AIC in UN.arima is lower than the AIC value in UN.arma and UN.arima2. 


```{r}
par(mfrow=c(1,1))
acf(na.omit(UN.arma$residuals),main="UN.arma")
acf(na.omit(UN.arima$residuals),main="UN.arima")
acf(na.omit(UN.arima2$residuals),main="UN.arima2")
```

The acf of residuals in UN.arima is lower than that in UN.arma model. Next, the residuals of these models are plotted in QQ plot as below.


```{r}
par(mfrow=c(1,3))
qqnorm(UN.arma$residuals, main="Q-Q plot: UN.arma")
qqline(residuals(UN.arma))
qqnorm(residuals(UN.arima), main="Q-Q plot: UN.arima")
qqline(residuals(UN.arima))
qqnorm(residuals(UN.arima2), main="Q-Q plot: UN.arima2")
qqline(residuals(UN.arima2))
```

From the QQ-plot of residuals in three models, the residuals of UN.arima fit better to the trend line than the residuals of UN.arma.The AIC in UN.arima is lower than the AIC value in UN.arma and UN.arima2. Take together, I would choose UN.arima model for UN.

```{r}
summary(GDP.arma)
summary(GDP.arima)
summary(GDP.arima2)
paste("GDP.arma=",summary(GDP.arma)$aic,"GDP.arima=",GDP.arima$aic,"GDP.arima2=",GDP.arima2$aic)
```

Next, I examine the residuals of these three models.

```{r}
par(mfrow=c(1,1))
acf(na.omit(GDP.arma$residuals),main="GDP.arma")
acf(na.omit(GDP.arima$residuals),main="GDP.arima")
acf(na.omit(GDP.arima$residuals),main="GDP.arima2")
par(mfrow=c(1,3))
qqnorm(GDP.arma$residuals, main="Q-Q plot: GDP.arma")
qqline(residuals(GDP.arma))
qqnorm(residuals(GDP.arima), main="Q-Q plot: GDP.arima")
qqline(residuals(GDP.arima))
qqnorm(residuals(GDP.arima2), main="Q-Q plot: GDP.arima2")
qqline(residuals(GDP.arima2))
```

The AIC in GDP.arima is lower that the AIC values in GDP. arma and GDP.arima2. From the acf plot and Q-Q plot of residuals, the patterns of residuals in these three models are similar. Take together, I would choose GDP.arima as the final model for GDP.

##3.Use the chosen UN and GDP models to forecast the UN and the GDP for 1969.

```{r}
library(forecast)
UN.forecast<-forecast(UN.arima,h=4);UN.forecast
GDP.forecast<-forecast(GDP.arima,h=4);GDP.forecast
```


##4.Compare your forecasts with the actual values using error = actual - estimate and plot the errors.

The error of forecasts is calculated as below.

```{r}
UN.forecast.error<- UN.all[57:60]-(UN.forecast$mean);UN.forecast.error
par(mfrow=c(1,1))
plot(UN.forecast)
ts.plot(UN.all,ts(UN.forecast$mean,start=c(1969,1),frequency=4),
        col=c("black","red"),
        xlab="year",type='o',lwd=2)
legend(x="topleft",
       legend=c("UN", "predicted UN"),
       col=c("black", "red"),
       pch=1,lty=c(1,1),
       lwd=3,cex=0.7)
```

```{r}
ts.plot(UN.all,ts(UN.forecast,start=c(1969,1),frequency=4),
        col=c("black","red"),
        xlab="year",type='o',lwd=2)
legend(x="topleft",
       legend=c("UN", "predicted UN"),
       col=c("black", "red"),
       pch=1,lty=c(1,1),
       lwd=3,cex=0.7)
```

```{r}

```

The forecasts of UN with this model are very good.

```{r}
GDP.forecast.error<- GDP.all[57:60]-(GDP.forecast$mean);GDP.forecast.error
ts.plot(GDP.all,ts(GDP.forecast$mean,start=c(1969,1),frequency=4),
        col=c("black","red"),xlab="year",type='o',lwd=2)
legend(x="topleft",
       legend=c("GDP", "predicted GDP"),
       col=c("black", "red"),
       pch=1,lty=c(1,1),
       lwd=3,cex=0.7)
```

The forecasts of GDP are very good.

##5.Calculate the Sum of squared(error) for each UN and GDP models.

The sum of squared for UN.arima model is

```{r}
SSE.UN.arima=sum((UN.arima$residuals)^2); SSE.UN.arima
```

The sum of squared for UN.arima forecast is

```{r}
SSE.UN.arima.forecast<-sum((UN.forecast.error)^2);SSE.UN.arima.forecast
```


The sum of squared for GDP.arima model is

```{r}
SSE.GDP.arima=sum((GDP.arima$residuals)^2); SSE.GDP.arima
```


The sum of squared for GDP.arima forecast is

```{r}
SSE.GDP.arima.forecast<-sum((GDP.forecast.error)^2);SSE.GDP.arima.forecast
```


#Regression - build regression models that use:

##1.UN as the independent variable and GDP as the dependent variable - use data from 1955 to 1968 to build the model. Forecast for 1969 and plot the errors and calculate the sum of squared(error) as previously.

```{r}
pairs(UN.GDP)
UN.GDP.forlm<-UN.GDP[1:56,]
lm.model<-lm(GDP~UN,data=UN.GDP.forlm)
summary(lm.model)
```


The prediction and prediction error of linear model are as below.

```{r}
GDP.lm.predict <- predict(lm.model,newdata=data.frame(UN.GDP[57:60,]))
GDP.lm.predict.error <- UN.GDP[57:60,2]-GDP.lm.predict; GDP.lm.predict.error
cbind("orginal"=UN.GDP[57:60,2],GDP.lm.predict,GDP.lm.predict.error)
```

plot the prediction in the graph

```{r}
ts.plot(GDP.all,ts(GDP.forecast$mean,start=c(1969,1),frequency=4),
        ts(GDP.lm.predict,start=c(1969,1),frequency=4),
        col=c("black","red","green"),xlab="year",type='o',lwd=2)
legend(x="topleft",
       legend=c("GDP", "predicted GDP arima","predicted GDP lm"),
       col=c("black", "red","green"),
       pch=1,lty=c(1,1,1),
       lwd=3,cex=0.7)
```


##2. GDP as the independent variable and UN as the dependent variable - use data from 1955 to 1968 to build the model. Forecast for 1969 and plot the errors and calculate the sum of squared(error) as previously.

```{r}
lm.model2<-lm(UN~GDP,data=UN.GDP.forlm)
summary(lm.model2)
```


```{r}
UN.lm.predict <- predict(lm.model2,newdata=data.frame(UN.GDP[57:60,]))
UN.lm.predict.error <- UN.GDP[57:60,1]-UN.lm.predict; UN.lm.predict.error
cbind("orginal"=UN.GDP[57:60,1],UN.lm.predict,UN.lm.predict.error)
```
```
plot the prediction in the graph

```{r}
ts.plot(UN.all,ts(UN.forecast$mean,start=c(1969,1),frequency=4),
        ts(UN.lm.predict,start=c(1969,1),frequency=4),
        col=c("black","red","green"),xlab="year",type='o',lwd=2)
legend(x="topleft",
       legend=c("UN", "predicted UN arima","predicted UN lm"),
       col=c("black", "red","green"),
       pch=1,lty=c(1,1,1),
       lwd=3,cex=0.7)
```

The sum of squared error in the models and in the forecast are as below


```{r}
SSE.lm.GDP <- sum((lm.model$residuals)^2)
SSE.lm.GDP.forecast <- sum((GDP.lm.predict.error)^2)
cbind(SSE.lm.GDP,SSE.lm.GDP.forecast)
SSE.lm.UN <- sum((lm.model2$residuals)^2)
SSE.lm.UN.forecast <- sum((UN.lm.predict.error)^2)
cbind(SSE.lm.UN,SSE.lm.UN.forecast)
```


##3. Compare the 2 models - any reason to believe which should be the independent and the dependent variables.

```{r}
par(mfrow=c(1,2))
qqnorm(lm.model$residuals, main="Q-Q plot: lm.model")
qqline(residuals(lm.model))
qqnorm(lm.model2$residuals, main="Q-Q plot: lm.model2")
qqline(residuals(lm.model2))
```


From summary of these two linear models, R squared values in both models are low and identical, which demonstrats both models don't fit well with the dataset. The intercept and slope in lm.model(to predict GDP) are both significant while only slope in lm.model2 (to predict UN) is significant. The QQ plot shows that the residuals of lm.model2 deviate more from trend line in both ends than the lm.model2. As comparision, UN as independent variable (GDP as dependent variable) in lm.model is better than GDP as independent variable(UN as dependent variable) in lm.model2. 
